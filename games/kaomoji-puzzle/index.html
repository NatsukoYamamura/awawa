<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ğŸ”¤ é¢œæ–‡å­—æ‹¼å›¾ - awa.wang</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --primary: #ffb7c5;
      --text: #5a4a66;
      --text-light: #8b7a99;
      --bg: linear-gradient(135deg, #fff5f7 0%, #f0f9ff 100%);
    }

    body {
      font-family: 'Segoe UI', 'PingFang SC', sans-serif;
      background: var(--bg);
      min-height: 100vh;
      overflow: hidden;
      user-select: none;
      touch-action: none;
    }

    .header {
      position: fixed;
      top: 0; left: 0; right: 0;
      padding: 15px 20px;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      box-shadow: 0 2px 20px rgba(180,120,200,0.15);
    }

    .back-btn {
      display: flex; align-items: center; gap: 6px;
      padding: 8px 16px;
      background: rgba(255,183,197,0.2);
      border: 2px solid var(--primary);
      border-radius: 50px;
      color: var(--text);
      text-decoration: none;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s;
    }

    .back-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
    }

    .info-panel {
      display: flex;
      gap: 15px;
      font-weight: 700;
      color: var(--text);
    }

    .info-item {
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      padding: 8px 16px;
      border-radius: 20px;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 100px 20px 120px;
    }

    .target-display {
      background: rgba(255,255,255,0.9);
      padding: 20px 40px;
      border-radius: 20px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(180,120,200,0.2);
      text-align: center;
    }

    .target-label {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 10px;
    }

    .target-kaomoji {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text);
      letter-spacing: 3px;
    }

    .puzzle-area {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      background: rgba(255,255,255,0.6);
      padding: 25px;
      border-radius: 25px;
      box-shadow: 0 8px 32px rgba(180,120,200,0.15);
      margin-bottom: 30px;
    }

    .puzzle-slot {
      width: 80px;
      height: 80px;
      background: rgba(255,255,255,0.8);
      border: 3px dashed var(--primary);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      transition: all 0.3s;
    }

    .puzzle-slot.filled {
      border-style: solid;
      background: linear-gradient(135deg, #fff5f7, #f0f9ff);
    }

    .puzzle-slot.correct {
      border-color: #4ade80;
      background: linear-gradient(135deg, #f0fdf4, #ecfdf5);
      animation: pulse-green 0.5s ease;
    }

    @keyframes pulse-green {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .pieces-area {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      max-width: 400px;
      background: rgba(255,255,255,0.6);
      padding: 20px;
      border-radius: 25px;
      box-shadow: 0 8px 32px rgba(180,120,200,0.15);
    }

    .piece {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      cursor: grab;
      box-shadow: 0 4px 15px rgba(255,154,158,0.4);
      transition: all 0.2s;
      user-select: none;
    }

    .piece:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255,154,158,0.6);
    }

    .piece:active {
      cursor: grabbing;
      transform: scale(0.95);
    }

    .piece.selected {
      ring: 4px solid var(--primary);
      transform: scale(1.1);
    }

    .piece.used {
      opacity: 0.3;
      pointer-events: none;
    }

    .controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 100;
    }

    .btn {
      padding: 12px 28px;
      border: none;
      border-radius: 50px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      color: white;
    }

    .btn-secondary {
      background: rgba(255,255,255,0.9);
      color: var(--text);
      border: 2px solid var(--primary);
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }

    .win-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 200;
      backdrop-filter: blur(5px);
    }

    .win-modal.show { display: flex; }

    .win-content {
      background: white;
      padding: 40px 60px;
      border-radius: 30px;
      text-align: center;
      animation: pop-in 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
      max-width: 90%;
    }

    @keyframes pop-in {
      from { transform: scale(0.5); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .win-content h2 {
      font-size: 2rem;
      color: var(--text);
      margin-bottom: 10px;
    }

    .win-content .emoji {
      font-size: 4rem;
      margin: 20px 0;
      animation: bounce 1s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    .win-content .message {
      font-size: 1.2rem;
      color: var(--text-light);
      margin-bottom: 25px;
      line-height: 1.6;
    }

    .win-content .stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 25px;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 800;
      background: linear-gradient(135deg, #ff9a9e, #a1c4fd);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-light);
    }

    .timer-bar {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 8px;
      background: rgba(255,255,255,0.6);
      border-radius: 10px;
      overflow: hidden;
      z-index: 90;
    }

    .timer-progress {
      height: 100%;
      background: linear-gradient(90deg, #ff9a9e, #a1c4fd);
      border-radius: 10px;
      transition: width 0.1s linear;
    }

    .hint {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.95);
      padding: 20px 40px;
      border-radius: 50px;
      color: var(--text-light);
      font-size: 1.1rem;
      z-index: 50;
      pointer-events: none;
      animation: fade-out 2s 1s forwards;
    }

    @keyframes fade-out { to { opacity: 0; } }

    .confetti {
      position: fixed;
      font-size: 1.5rem;
      pointer-events: none;
      z-index: 150;
      animation: confetti-fall 2s linear forwards;
    }

    @keyframes confetti-fall {
      to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    @media (max-width: 600px) {
      .puzzle-slot { width: 60px; height: 60px; font-size: 1.5rem; }
      .piece { width: 50px; height: 50px; font-size: 1.5rem; }
      .target-kaomoji { font-size: 2rem; }
      .win-content { padding: 30px 40px; margin: 20px; }
      .timer-bar { width: 260px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <a href="/games" class="back-btn">â† è¿”å›</a>
    <div class="info-panel">
      <div class="info-item">â­ å…³å¡ï¼š<span id="level">1</span></div>
      <div class="info-item">â±ï¸ æ—¶é—´ï¼š<span id="timeLeft">60</span>s</div>
    </div>
  </div>

  <div class="timer-bar">
    <div class="timer-progress" id="timerProgress"></div>
  </div>

  <div class="hint" id="hint">ğŸ‘† ç‚¹å‡»éƒ¨ä»¶ï¼Œå†ç‚¹å‡»ç©ºä½æ”¾ç½®ï½</div>

  <div class="game-container">
    <div class="target-display">
      <div class="target-label">ç›®æ ‡é¢œæ–‡å­—</div>
      <div class="target-kaomoji" id="targetKaomoji">(â—â€¢á´—â€¢â—)</div>
    </div>

    <div class="puzzle-area" id="puzzleArea">
      <!-- åŠ¨æ€ç”Ÿæˆæ’æ§½ -->
    </div>

    <div class="pieces-area" id="piecesArea">
      <!-- åŠ¨æ€ç”Ÿæˆéƒ¨ä»¶ -->
    </div>
  </div>

  <div class="controls">
    <button class="btn btn-secondary" onclick="resetLevel()">ğŸ”„ é‡ç½®</button>
    <button class="btn btn-primary" onclick="nextLevel()" id="nextBtn" style="display:none">â¡ï¸ ä¸‹ä¸€å…³</button>
  </div>

  <div class="win-modal" id="winModal">
    <div class="win-content">
      <h2>ğŸ‰ å®Œæˆå•¦ï¼</h2>
      <div class="emoji">ğŸ’–</div>
      <p class="message" id="winMessage">ä½ è¶…å¯çˆ±çš„ï¼</p>
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="winTime">0</div>
          <div class="stat-label">å‰©ä½™æ—¶é—´</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="winMoves">0</div>
          <div class="stat-label">ä½¿ç”¨æ­¥æ•°</div>
        </div>
      </div>
      <button class="btn btn-primary" onclick="nextLevel()">â¡ï¸ ä¸‹ä¸€å…³</button>
    </div>
  </div>

  <script>
    // ========== é¢œæ–‡å­—å…³å¡æ•°æ® ==========
    const LEVELS = [
      { kaomoji: '(â—â€¢á´—â€¢â—)', parts: ['(', 'â—', 'â€¢', 'á´—', 'â€¢', 'â—', ')'], time: 60 },
      { kaomoji: '(â„ â„â€¢â„Ï‰â„â€¢â„ â„)', parts: ['(', 'â„', 'â„', 'â€¢', 'â„', 'Ï‰', 'â„', 'â€¢', 'â„', 'â„', ')'], time: 90 },
      { kaomoji: 'âœ§â—(â°â–¿â°)â—œâœ§', parts: ['âœ§', 'â—', '(', 'â°', 'â–¿', 'â°', ')', 'â—œ', 'âœ§'], time: 75 },
      { kaomoji: '(ï½¡â€¢Ì€á´—-)âœ§', parts: ['(', 'ï½¡', 'â€¢', 'Ì€', 'á´—', '-', ')', 'âœ§'], time: 60 },
      { kaomoji: 'ãƒ½ (âœ¿ï¾Ÿâ–½ï¾Ÿ) ãƒ', parts: ['ãƒ½', '(', 'âœ¿', 'ï¾Ÿ', 'â–½', 'ï¾Ÿ', ')', 'ãƒ'], time: 70 },
      { kaomoji: 'â˜†âŒ’(â‰§â–½Â°)', parts: ['â˜†', 'âŒ’', '(', 'â‰§', 'â–½', 'Â°', ')'], time: 60 },
      { kaomoji: '(à¹‘â€¢á´—â€¢à¹‘)â™¡', parts: ['(', 'à¹‘', 'â€¢', 'á´—', 'â€¢', 'à¹‘', ')', 'â™¡'], time: 65 },
      { kaomoji: 'â•° (â–”âˆ€â–”) â•¯', parts: ['â•°', '(', 'â–”', 'âˆ€', 'â–”', ')', 'â•¯'], time: 60 }
    ];

    const WIN_MESSAGES = [
      'ä½ è¶…å¯çˆ±çš„ï¼ğŸ’–',
      'awawaï½å¤ªæ£’äº†ï¼âœ¨',
      'é¢œæ–‡å­—å¤§å¸ˆå°±æ˜¯ä½ ï¼ğŸ†',
      'æ‹¼å¾—å®Œç¾ï¼ç»§ç»­åŠ æ²¹ï½ğŸŒ¸',
      'æ‰‹é€ŸæƒŠäººï¼å‰å®³å‰å®³ï¼â­'
    ];

    // ========== å˜é‡ ==========
    let currentLevel = 0;
    let timeLeft = 60;
    let timerInterval;
    let moves = 0;
    let selectedPiece = null;
    let placedParts = [];
    let isComplete = false;

    // ========== åˆå§‹åŒ– ==========
    function init() {
      loadLevel(currentLevel);
      startTimer();
    }

    function loadLevel(levelIndex) {
      const level = LEVELS[levelIndex % LEVELS.length];
      document.getElementById('level').textContent = levelIndex + 1;
      document.getElementById('targetKaomoji').textContent = level.kaomoji;
      timeLeft = level.time;
      moves = 0;
      placedParts = new Array(level.parts.length).fill(null);
      isComplete = false;
      selectedPiece = null;
      document.getElementById('nextBtn').style.display = 'none';
      
      renderPuzzleArea(level.parts.length);
      renderPieces(level.parts);
      updateTimerDisplay();
    }

    function renderPuzzleArea(slotCount) {
      const area = document.getElementById('puzzleArea');
      area.innerHTML = '';
      area.style.gridTemplateColumns = `repeat(${Math.ceil(slotCount / 3)}, 1fr)`;
      
      for (let i = 0; i < slotCount; i++) {
        const slot = document.createElement('div');
        slot.className = 'puzzle-slot';
        slot.dataset.index = i;
        slot.addEventListener('click', () => handleSlotClick(i));
        area.appendChild(slot);
      }
    }

    function renderPieces(parts) {
      const area = document.getElementById('piecesArea');
      area.innerHTML = '';
      
      // æ‰“ä¹±éƒ¨ä»¶é¡ºåº
      const shuffled = [...parts].sort(() => Math.random() - 0.5);
      
      shuffled.forEach((part, index) => {
        const piece = document.createElement('div');
        piece.className = 'piece';
        piece.textContent = part;
        piece.dataset.part = part;
        piece.dataset.originalIndex = parts.indexOf(part);
        piece.addEventListener('click', () => handlePieceClick(piece));
        area.appendChild(piece);
      });
    }

    function handlePieceClick(piece) {
      if (isComplete || piece.classList.contains('used')) return;
      
      // å–æ¶ˆä¹‹å‰çš„é€‰æ‹©
      document.querySelectorAll('.piece.selected').forEach(p => p.classList.remove('selected'));
      
      // é€‰æ‹©æ–°éƒ¨ä»¶
      piece.classList.add('selected');
      selectedPiece = piece;
      playSound('select');
    }

    function handleSlotClick(slotIndex) {
      if (isComplete || !selectedPiece || placedParts[slotIndex] !== null) return;
      
      const level = LEVELS[currentLevel % LEVELS.length];
      const correctPart = level.parts[slotIndex];
      const selectedPart = selectedPiece.dataset.part;
      
      // æ”¾ç½®éƒ¨ä»¶
      placedParts[slotIndex] = selectedPart;
      selectedPiece.classList.add('used', 'selected');
      
      const slot = document.querySelector(`.puzzle-slot[data-index="${slotIndex}"]`);
      slot.textContent = selectedPart;
      slot.classList.add('filled');
      
      moves++;
      playSound('place');
      
      // æ£€æŸ¥æ˜¯å¦æ­£ç¡®
      if (selectedPart === correctPart) {
        slot.classList.add('correct');
        playSound('correct');
      } else {
        setTimeout(() => {
          slot.classList.remove('correct');
        }, 500);
      }
      
      selectedPiece = null;
      document.querySelectorAll('.piece.selected').forEach(p => p.classList.remove('selected'));
      
      // æ£€æŸ¥æ˜¯å¦å®Œæˆ
      checkCompletion();
    }

    function checkCompletion() {
      const level = LEVELS[currentLevel % LEVELS.length];
      const isAllPlaced = placedParts.every(p => p !== null);
      
      if (!isAllPlaced) return;
      
      const isCorrect = placedParts.every((part, i) => part === level.parts[i]);
      
      if (isCorrect) {
        completeLevel();
      } else {
        // å…¨éƒ¨æ”¾ç½®ä½†é”™è¯¯ï¼Œé‡ç½®
        setTimeout(() => {
          alert('âŒ é¡ºåºä¸å¯¹å“¦ï½å†è¯•ä¸€æ¬¡å§ï¼');
          resetLevel();
        }, 500);
      }
    }

    function completeLevel() {
      isComplete = true;
      clearInterval(timerInterval);
      playSound('win');
      createConfetti();
      
      document.getElementById('winTime').textContent = timeLeft;
      document.getElementById('winMoves').textContent = moves;
      document.getElementById('winMessage').textContent = WIN_MESSAGES[Math.floor(Math.random() * WIN_MESSAGES.length)];
      document.getElementById('winModal').classList.add('show');
      document.getElementById('nextBtn').style.display = 'block';
    }

    function nextLevel() {
      currentLevel++;
      document.getElementById('winModal').classList.remove('show');
      loadLevel(currentLevel);
      startTimer();
    }

    function resetLevel() {
      loadLevel(currentLevel);
      startTimer();
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        
        if (timeLeft <= 0) {
          gameOver();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      document.getElementById('timeLeft').textContent = timeLeft;
      const level = LEVELS[currentLevel % LEVELS.length];
      const progress = (timeLeft / level.time) * 100;
      document.getElementById('timerProgress').style.width = `${progress}%`;
      
      // æ—¶é—´è­¦å‘Šè‰²
      if (timeLeft <= 10) {
        document.getElementById('timerProgress').style.background = 'linear-gradient(90deg, #ff6b6b, #ee5a5a)';
      } else {
        document.getElementById('timerProgress').style.background = 'linear-gradient(90deg, #ff9a9e, #a1c4fd)';
      }
    }

    function gameOver() {
      clearInterval(timerInterval);
      playSound('gameover');
      alert('â° æ—¶é—´åˆ°å•¦ï½å†è¯•ä¸€æ¬¡å§ï¼');
      resetLevel();
    }

    function playSound(type) {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      if (type === 'select') {
        oscillator.frequency.value = 600;
        gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      } else if (type === 'place') {
        oscillator.frequency.value = 500;
        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.15);
      } else if (type === 'correct') {
        oscillator.frequency.value = 800;
        oscillator.frequency.exponentialRampToValueAtTime(1000, audioContext.currentTime + 0.2);
        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.2);
      } else if (type === 'win') {
        [523, 659, 784, 1046].forEach((freq, i) => {
          const osc = audioContext.createOscillator();
          const gain = audioContext.createGain();
          osc.connect(gain);
          gain.connect(audioContext.destination);
          osc.frequency.value = freq;
          gain.gain.setValueAtTime(0.15, audioContext.currentTime + i * 0.1);
          gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.4);
          osc.start(audioContext.currentTime + i * 0.1);
          osc.stop(audioContext.currentTime + i * 0.1 + 0.4);
        });
      } else if (type === 'gameover') {
        oscillator.frequency.value = 300;
        oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 0.3);
        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
      }
    }

    function createConfetti() {
      const emojis = ['âœ¨', 'ğŸ’–', 'ğŸŒ¸', 'â­', 'ğŸ‰', 'ğŸ«§'];
      for (let i = 0; i < 40; i++) {
        setTimeout(() => {
          const conf = document.createElement('div');
          conf.className = 'confetti';
          conf.textContent = emojis[Math.floor(Math.random() * emojis.length)];
          conf.style.left = `${Math.random() * 100}%`;
          conf.style.top = '-50px';
          conf.style.animationDuration = `${Math.random() * 2 + 2}s`;
          document.body.appendChild(conf);
          setTimeout(() => conf.remove(), 4000);
        }, i * 50);
      }
    }

    init();
  </script>
</body>
</html>